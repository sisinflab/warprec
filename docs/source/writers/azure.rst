Azure Writer
=============

The ``Azure Writer`` of **WarpRec** is designed to track and persist all experiment results, trained models, and configuration details directly to **Azure Blob Storage**.
It provides seamless cloud-based persistence while maintaining the same organizational structure and conventions as the ``Local Writer``.

.. warning::

    The Azure Writer is part of the extra *remote-io*. You can download it via pip:

    .. code-block:: bash

        pip install warprec[remote-io]

Writing to Azure Blob Storage
-----------------------------

When an experiment starts, WarpRec automatically initializes a dedicated, timestamped **Azure Blob directory** (i.e., a virtual folder) within the specified container.
All experiment artifacts are uploaded to this location, following the same logical structure as a local experiment directory::

    azure-container/
    ├── evaluation/
    ├── params/
    ├── recs/
    ├── serialized/
    ├── split/
    └── config.json

Each blob and virtual directory is **timestamped** to ensure reproducibility and allow multiple runs within the same Azure container without overwriting previous results.

Directory (Blob) Contents
^^^^^^^^^^^^^^^^^^^^^^^^^

.. list-table::
   :widths: 25 75
   :header-rows: 1

   * - Virtual Directory / Blob
     - Description
   * - **evaluation/**
     - Contains model evaluation results, including metric scores and a detailed report with temporal and spatial information (unless disabled).
   * - **params/**
     - Stores hyperparameter configurations found during the Hyperparameter Optimization (HPO) phase.
   * - **recs/**
     - Contains the final recommendations produced by each model (if enabled).
   * - **serialized/**
     - Stores the serialized (pickled) versions of trained models (if serialization is enabled).
   * - **split/**
     - Contains the dataset splits (train/validation/test) used for the experiment (if enabled).
   * - **config.json**
     - A fully resolved configuration file for the experiment. This includes user-specified values and automatically set default parameters, ensuring precise tracking of the configuration used for each run.

Evaluation Reporting Artifacts
------------------------------

Within the ``evaluation/`` blob directory, WarpRec produces two primary, timestamped artifacts that are automatically uploaded to Azure Blob Storage.

Overall Results
^^^^^^^^^^^^^^^

A tabular file (``Overall_Results``) summarizing the evaluation metrics per model and cutoff :math:`\mathbf{k}`::

    Model       Top@k   Metric_1    Metric_2    ...
    My_Model    10      0.001       0.002       ...
    ...

.. note::

    - One row is produced per :math:`\mathbf{(model, k)}` combination.
    - Metrics reflect the configured evaluation protocol (e.g., full vs. sampled).

Time Report
^^^^^^^^^^^

A timing and environment summary file (``Time_Report``) with wall-clock measurements:

* **Data Preparation Time:** End-to-end data preparation (splitting, filtering, evaluation sampling if enabled).
* **Hyperparameter Exploration Time:** Total HPO duration, including Ray cluster bootstrap/initialization overhead.
* **Average Trial Time:** Mean training time per trial, including end-of-epoch evaluation.
* **Evaluation Time:** Time to evaluate the best model; depends on the evaluation strategy (“full” or “sampled”).
* **Inference Time (ms):** Time to predict for :math:`\mathbf{1,000 users \times 1,000 items}`; intended as a comparative guideline.
* **Total Time:** Aggregate end-to-end duration for the model’s experiment pipeline.

Unless otherwise specified, durations are wall-clock; inference time is reported in milliseconds.

Dataset Split Structure
-----------------------

The ``split/`` blob directory contains the dataset partitions generated by WarpRec, if dataset splitting is enabled.
The structure mirrors that of the local version, but all files are uploaded as separate blobs under the Azure container::

    azure-container/
    ├── split/
    |   ├── train.tsv
    |   ├── validation.tsv
    |   ├── test.tsv
    |   ├── 1/
    |   |   ├── train.tsv
    |   |   ├── validation.tsv
    |   ├── 2/
    |   |   ├── train.tsv
    |   |   ├── validation.tsv
    ...
    └── config.json

.. note::

    - The output format (e.g., **TSV**) is configurable.
    - At the **top level** of the ``split/`` blob directory, you will find the primary **train/validation/test split**.
    - If validation folds are generated (e.g., for cross-validation), subdirectories named ``1/``, ``2/``, etc., are created. Each contains its own **train/validation split**.
    - Each file is automatically uploaded as a distinct blob with its corresponding name and virtual path.
